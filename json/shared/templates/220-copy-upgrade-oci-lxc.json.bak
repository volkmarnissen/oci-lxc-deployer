{
  "execute_on": "ve",
  "name": "Copy-Upgrade LXC from OCI Image",
  "description": "Downloads an OCI image, creates a new LXC container from it, then copies relevant configuration from an existing lxc-manager managed container (mappings/devices/bind mounts) while keeping the new rootfs. Finally starts the new container and waits for readiness.\n\nFlow:\n- 011: Download OCI image and import to Proxmox storage\n- 220: Create new container + merge config from source\n- 200: Start container\n- 210: Wait for readiness",
  "parameters": [
    {
      "id": "source_vm_id",
      "name": "Source VM ID",
      "type": "number",
      "required": true,
      "description": "Existing (source) LXC container ID that was created by lxc-manager. Its config will be used as the base for mappings/devices/bind mounts."
    },
    {
      "id": "vm_id",
      "name": "Target VM ID",
      "type": "number",
      "default": "",
      "advanced": true,
      "description": "Optional: VM/CT ID for the new container. If empty, the next free ID will be used."
    },
    {
      "id": "disk_size",
      "name": "Disk size (GB)",
      "type": "string",
      "default": "4",
      "advanced": true,
      "description": "Root filesystem size for the new container in GB."
    },
    {
      "id": "bridge",
      "name": "Network bridge",
      "type": "string",
      "default": "vmbr0",
      "advanced": true,
      "description": "Network bridge used for the temporary container config created during upgrade. The final network config comes from the source container config."
    },
    {
      "id": "memory",
      "name": "Memory (MB)",
      "type": "number",
      "default": 512,
      "advanced": true,
      "description": "Memory used for the temporary container config created during upgrade. The final memory config comes from the source container config."
    }
  ],
  "commands": [
    {
      "name": "Get OCI Image",
      "template": "011-get-oci-image.json"
    },
    {
      "name": "Copy-Upgrade: Create & Merge Config",
      "script": "copy-upgrade-oci-lxc.sh",
      "outputs": ["vm_id"]
    },
    {
      "name": "Start LXC",
      "template": "200-start-lxc.json"
    },
    {
      "name": "Wait for Container Ready",
      "template": "210-wait-for-container-ready.json"
    }
  ]
}
